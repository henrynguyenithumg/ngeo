!function(t){function e(e){for(var i,s,o=e[0],l=e[1],u=e[2],h=0,f=[];h<o.length;h++)s=o[h],a[s]&&f.push(a[s][0]),a[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);for(c&&c(e);f.length;)f.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,o=1;o<n.length;o++){var l=n[o];0!==a[l]&&(i=!1)}i&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},a={14:0},r=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var c=l;r.push([406,0]),n()}({291:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=m(n(13)),a=g(n(1)),r=g(n(4)),s=m(n(33)),o=g(n(30)),l=m(n(46)),u=m(n(40)),c=m(n(51)),h=m(n(131)),f=m(n(45)),d=m(n(93)),p=m(n(84));function g(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function m(t){return t&&t.__esModule?t:{default:t}}var _=function(t){f.default.call(this,{handleEvent:o.TRUE}),this.changeEventKey_=null,this.type_=t.type,this.minPoints_=t.minPoints?t.minPoints:"Polygon"===this.type_?3:2,this.sketchFeature_=null,this.sketchPoints_=[],this.sketchPoint_=null,this.overlay_=new d.default({source:new p.default({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:h.default.getDefaultStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),r.listen(this,"change:active",this.updateState_,this),this.set("dirty",!1),this.set("drawing",!1),this.set("valid",!1)};a.inherits(_,f.default),_.prototype.setMap=function(t){this.getMap()&&this.changeEventKey_&&r.unlistenByKey(this.changeEventKey_),f.default.prototype.setMap.call(this,t),t&&(this.changeEventKey_=r.listen(t.getView(),"change:center",this.handleViewCenterChange_,this)),this.updateState_()},_.prototype.getDirty=function(){return this.get("dirty")},_.prototype.getDrawing=function(){return this.get("drawing")},_.prototype.getValid=function(){return this.get("valid")},_.prototype.getFeature=function(){return this.sketchFeature_},_.prototype.addToDrawing=function(){var t=this.getActive(),e=this.getDrawing();if(t&&e){var n=void 0,a=this.getSketchPointGeometry_().getCoordinates(),r=void 0;if("Point"===this.type_)return this.sketchFeature_||(this.sketchFeature_=new s.default(new u.default(a)),this.dispatchEvent(new h.default.Event("drawstart",this.sketchFeature_))),n=this.sketchFeature_.getGeometry(),i.default.assertInstanceof(n,c.default),void n.setCoordinates(a);"LineString"===this.type_&&(this.sketchPoints_.push(this.sketchPoint_),this.sketchFeature_?(n=this.sketchFeature_.getGeometry(),i.default.assertInstanceof(n,c.default),(r=n.getCoordinates()).push(a.slice()),n.setCoordinates(r)):(r=[a.slice(),a.slice()],this.sketchFeature_=new s.default(new l.default(r)),this.dispatchEvent(new h.default.Event("drawstart",this.sketchFeature_)))),this.getDirty()&&this.set("dirty",!1);var o=this.getValid();"LineString"===this.type_&&(r.length>=this.minPoints_?o||this.set("valid",!0):o&&this.set("valid",!1)),this.sketchPoint_=null,this.updateSketchFeatures_()}},_.prototype.clearDrawing=function(){this.setActive(!1),this.setActive(!0)},_.prototype.finishDrawing=function(){var t=this.getActive(),e=this.getDrawing();t&&e&&(this.sketchPoint_&&this.addToDrawing(),this.set("drawing",!1),this.dispatchEvent(new h.default.Event("drawend",this.sketchFeature_)))},_.prototype.startDrawing_=function(){this.set("drawing",!0),this.createOrUpdateSketchPoint_(),this.updateSketchFeatures_(),"Point"===this.type_&&this.addToDrawing()},_.prototype.modifyDrawing_=function(){if(this.sketchFeature_){var t=this.getCenter_();if("LineString"===this.type_){var e=this.sketchFeature_.getGeometry();i.default.assertInstanceof(e,c.default);var n=e.getCoordinates();n.pop(),n.push(t),e.setCoordinates(n)}this.getDirty()||this.set("dirty",!0)}},_.prototype.abortDrawing_=function(){var t=this.sketchFeature_;return(t||this.sketchPoints_.length>0)&&(this.sketchFeature_=null,this.sketchPoint_=null,this.overlay_.getSource().clear(!0)),this.sketchPoints_=[],this.set("dirty",!1),this.set("drawing",!1),this.set("valid",!1),t},_.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e?this.startDrawing_():this.abortDrawing_(),this.overlay_.setMap(e?t:null)},_.prototype.handleViewCenterChange_=function(t){var e=this.getActive(),n=this.getDrawing();e&&n&&(this.createOrUpdateSketchPoint_(),"Point"===this.type_?this.addToDrawing():(this.modifyDrawing_(),this.updateSketchFeatures_()))},_.prototype.createOrUpdateSketchPoint_=function(){var t=this.getCenter_();this.sketchPoint_?this.getSketchPointGeometry_().setCoordinates(t):this.sketchPoint_=new s.default(new u.default(t))},_.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t),e.addFeatures(this.sketchPoints_)},_.prototype.getSketchPointGeometry_=function(){i.default.assert(this.sketchPoint_,"sketch point should be thruty");var t=this.sketchPoint_.getGeometry();return i.default.assertInstanceof(t,u.default),t},_.prototype.getCenter_=function(){var t=this.getMap().getView().getCenter();return i.default.assertArray(t),t},e.default=_},399:function(t,e){t.exports='<a class="btn btn-default" ng-if=ctrl.active ng-click=ctrl.deactivate()> <span class="fa fa-times"></span> {{\'Close\' | translate}} </a> '},400:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=c(n(13)),a=c(n(214)),r=c(n(291)),s=u(n(1)),o=u(n(8)),l=c(n(40));function u(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function c(t){return t&&t.__esModule?t:{default:t}}var h=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o.assign(n,{displayHelpTooltip:!1}),a.default.call(this,n),this.format_=t,this.coordFormat_=e};s.inherits(h,a.default),h.prototype.createDrawInteraction=function(t,e){return new r.default({type:"Point",style:t,source:e})},h.prototype.handleMeasure=function(t){var e=i.default.assertInstanceof(this.sketchFeature.getGeometry(),l.default),n=this.decimals;t(a.default.getFormattedPoint(e,n,this.format_,this.coordFormat_),e.getLastCoordinate())},e.default=h},401:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(n(243)),a=d(n(13)),r=d(n(400)),s=d(n(206)),o=d(n(152)),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(4)),u=d(n(58)),c=d(n(141)),h=d(n(56)),f=d(n(38));function d(t){return t&&t.__esModule?t:{default:t}}var p=angular.module("gmfMobileMeasurePoint",[i.default.module.name,s.default.name]);p.value("gmfMobileMeasurePointTemplateUrl",function(t,e){var n=e.gmfMobileMeasurePointTemplateurl;return void 0!==n?n:"gmf/measure/pointComponent"}),p.run(["$templateCache",function(t){t.put("gmf/measure/pointComponent",n(399))}]),p.component_=function(t){return{restrict:"A",scope:{active:"=gmfMobileMeasurepointActive",getCoordinateDecimalsFn:"&?gmfMobileMeasurepointCoordinatedecimals",getLayersConfigFn:"&gmfMobileMeasurepointLayersconfig",map:"=gmfMobileMeasurepointMap",sketchStyle:"=?gmfMobileMeasurepointSketchstyle",format:"<gmfMobileMeasurepointFormat"},controller:"GmfMobileMeasurePointController as ctrl",bindToController:!0,templateUrl:t,link:function(t,e,n,i){i.init()}}},p.component_.$inject=["gmfMobileMeasurePointTemplateUrl"],p.directive("gmfMobileMeasurepoint",p.component_),p.Controller_=function(t,e,n,i,a){var r=this;this.gmfRaster_=i,this.ngeoDebounce_=a,this.gettextCatalog_=t,this.$filter_=n,this.map,this.active,e.$watch(function(){return r.active},function(t){r.measure.setActive(t),r.handleMeasureActiveChange_()});var s=this.getCoordinateDecimalsFn;this.coordinateDecimals=s?s():0,this.layersConfig,this.sketchStyle,void 0===this.sketchStyle&&(this.sketchStyle=new f.default({fill:new u.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new h.default({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new c.default({stroke:new h.default({color:"rgba(0, 0, 0, 0.7)",width:2}),points:4,radius:8,radius2:0,angle:0})})),this.format,this.measure,this.drawInteraction,this.mapViewPropertyChangeEventKey_=null},p.Controller_.$inject=["gettextCatalog","$scope","$filter","gmfRaster","ngeoDebounce"],p.Controller_.prototype.init=function(){this.measure=new r.default(this.$filter_("ngeoNumberCoordinates"),this.format||"{x}, {y}",{decimals:this.coordinateDecimals,sketchStyle:this.sketchStyle}),this.measure.setActive(this.active),o.default.interaction(this.measure),this.drawInteraction=this.measure.getDrawInteraction(),o.default.interaction(this.drawInteraction);var t=this.getLayersConfigFn();a.default.assert(Array.isArray(t)),this.layersConfig=t,this.map.addInteraction(this.measure)},p.Controller_.prototype.deactivate=function(){this.active=!1},p.Controller_.prototype.translate=function(t){return this.gettextCatalog_.getString(t)},p.Controller_.prototype.handleMeasureActiveChange_=function(){if(this.measure.getActive()){var t=this.map.getView();this.mapViewPropertyChangeEventKey_=l.listen(t,"propertychange",this.ngeoDebounce_(this.getMeasure_.bind(this),300,!0),this),this.getMeasure_()}else this.mapViewPropertyChangeEventKey_&&(l.unlistenByKey(this.mapViewPropertyChangeEventKey_),this.mapViewPropertyChangeEventKey_=null)},p.Controller_.prototype.getMeasure_=function(){var t=this,e=this.map.getView().getCenter();a.default.assertArray(e);var n={layers:this.layersConfig.map(function(t){return t.name}).join(",")};this.gmfRaster_.getRaster(e,n).then(function(e){var n=t.measure.getTooltipElement(),i=document.createElement("div");i.className="gmf-mobile-measure-point";var a=!0,r=!1,s=void 0;try{for(var o,l=t.layersConfig[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value,c=u.name;if(c in e){var h=e[c],f=document.createElement("div");f.className="gmf-mobile-measure-point-"+c;var d=u.unit||"",p=u.decimals&&u.decimals>0||0;h=t.$filter_("number")(h,p),f.innerHTML=[t.translate(c),": ",h," ",d].join(""),i.appendChild(f)}}}catch(t){r=!0,s=t}finally{try{!a&&l.return&&l.return()}finally{if(r)throw s}}var g=n.getElementsByClassName("gmf-mobile-measure-point");g[0]&&g[0].remove(),n.appendChild(i)})},p.controller("GmfMobileMeasurePointController",p.Controller_),p.LayerConfig,e.default=p},402:function(t,e){t.exports='<a class="btn btn-default" ng-if="ctrl.drawing && (!ctrl.valid)" ng-click=ctrl.addPoint()> <span class="fa fa-check"></span> {{\'Set as starting point\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.dirty ng-click=ctrl.addPoint()> <span class="fa fa-plus"></span> {{\'Add new point\' | translate}} </a> <a class="btn btn-default" ng-if="ctrl.drawing && ctrl.valid && !ctrl.dirty" ng-click=ctrl.finish()> <span class="fa fa-check"></span> {{\'Terminate\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.valid ng-click=ctrl.clear()> <span class="fa fa-repeat"></span> {{\'Clear\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.active ng-click=ctrl.deactivate()> <span class="fa fa-times"></span> {{\'Close\' | translate}} </a> '},403:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(n(273)),a=l(n(291)),r=o(n(1)),s=o(n(8));function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function l(t){return t&&t.__esModule?t:{default:t}}var u=function(t,e){var n=void 0!==e?e:{};s.assign(n,{displayHelpTooltip:!1}),i.default.call(this,t,n)};r.inherits(u,i.default),u.prototype.createDrawInteraction=function(t,e){return new a.default({type:"LineString",style:t,source:e})},e.default=u},404:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=f(n(155)),a=f(n(403)),r=f(n(152)),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(4)),o=f(n(22)),l=f(n(58)),u=f(n(141)),c=f(n(56)),h=f(n(38));function f(t){return t&&t.__esModule?t:{default:t}}var d=angular.module("gmfMobileMeasureLength",[i.default.name]);d.value("gmfMobileMeasureLengthTemplateUrl",function(t,e){var n=e.gmfMobileMeasureLengthTemplateurl;return void 0!==n?n:"gmf/measure/lengthComponent"}),d.run(["$templateCache",function(t){t.put("gmf/measure/lengthComponent",n(402))}]),d.component_=function(t){return{restrict:"A",scope:{active:"=gmfMobileMeasurelengthActive",precision:"<?gmfMobileMeasurelengthPrecision",map:"=gmfMobileMeasurelengthMap",sketchStyle:"=?gmfMobileMeasurelengthSketchstyle"},controller:"GmfMobileMeasureLengthController as ctrl",bindToController:!0,templateUrl:t,link:function(t,e,n,i){i.init()}}},d.component_.$inject=["gmfMobileMeasureLengthTemplateUrl"],d.directive("gmfMobileMeasurelength",d.component_),d.Controller_=function(t,e){var n=this;this.scope_=t,this.filter_=e,this.map,this.active,this.scope_.$watch(function(){return n.active},function(t){n.measure.setActive(t)}),this.precision,this.sketchStyle=new h.default({fill:new l.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new c.default({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new u.default({stroke:new c.default({color:"rgba(0, 0, 0, 0.7)",width:2}),points:4,radius:8,radius2:0,angle:0})}),this.measure,this.drawInteraction,this.dirty=!1,this.drawing=!1,this.valid=!1},d.Controller_.$inject=["$scope","$filter"],d.Controller_.prototype.init=function(){this.measure=new a.default(this.filter_("ngeoUnitPrefix"),{precision:this.precision,sketchStyle:this.sketchStyle}),this.measure.setActive(this.active),r.default.interaction(this.measure),this.drawInteraction=this.measure.getDrawInteraction();var t=this.drawInteraction;r.default.interaction(t),Object.defineProperty(this,"hasPoints",{get:function(){return null!==this.drawInteraction.getFeature()}}),s.listen(t,o.default.getChangeEventType("dirty"),function(){this.dirty=t.getDirty(),this.dirty&&this.scope_.$apply()},this),s.listen(t,o.default.getChangeEventType("drawing"),function(){this.drawing=t.getDrawing()},this),s.listen(t,o.default.getChangeEventType("valid"),function(){this.valid=t.getValid()},this),this.map.addInteraction(this.measure)},d.Controller_.prototype.addPoint=function(){this.drawInteraction.addToDrawing()},d.Controller_.prototype.clear=function(){this.drawInteraction.clearDrawing()},d.Controller_.prototype.finish=function(){this.drawInteraction.finishDrawing()},d.Controller_.prototype.deactivate=function(){this.active=!1},d.controller("GmfMobileMeasureLengthController",d.Controller_),e.default=d},405:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(599);var i=p(n(70)),a=p(n(208)),r=p(n(404)),s=p(n(401)),o=p(n(164)),l=p(n(83)),u=p(n(52)),c=p(n(61)),h=p(n(364)),f=p(n(49)),d=p(n(79));function p(t){return t&&t.__esModule?t:{default:t}}var g={};g.module=angular.module("gmfapp",["gettext",i.default.name,a.default.module.name,r.default.name,s.default.name,o.default.name]),g.module.value("gmfRasterUrl","https://geomapfish-demo.camptocamp.net/2.2/wsgi/raster"),g.module.constant("defaultTheme","Demo"),g.module.constant("angularLocaleScript","../build/angular-locale_{{locale}}.js"),g.MainController=function(t){var e=t.getMapCenter()||[537635,152640],n=t.getMapZoom()||3;this.map=new u.default({layers:[new f.default({source:new d.default})],view:new c.default({projection:l.default,resolutions:[200,100,50,20,10,5,2.5,2,1,.5],center:e,zoom:n})}),this.map.addControl(new h.default),this.measureLengthActive=!1,this.measurePointLayersConfig={aster:{unit:"m",decimals:2},srtm:{unit:"m"}},this.measurePointActive=!1},g.MainController.$inject=["gmfPermalink"],g.module.controller("MainController",g.MainController),e.default=g},406:function(t,e,n){n(54),n(53),t.exports=n(405)},599:function(t,e){}});
//# sourceMappingURL=mobilemeasure.f111163c0ec65e9b1a15.js.map