!function(e){function t(t){for(var o,i,s=t[0],l=t[1],u=t[2],h=0,f=[];h<s.length;h++)i=s[h],a[i]&&f.push(a[i][0]),a[i]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(d&&d(t);f.length;)f.shift()();return n.push.apply(n,u||[]),r()}function r(){for(var e,t=0;t<n.length;t++){for(var r=n[t],o=!0,s=1;s<r.length;s++){var l=r[s];0!==a[l]&&(o=!1)}o&&(n.splice(t--,1),e=i(i.s=r[0]))}return e}var o={},a={11:0},n=[];function i(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=o,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var d=l;n.push([390,0]),r()}({389:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(594);var o=u(r(13)),a=u(r(235)),n=u(r(260)),i=u(r(57)),s=u(r(195)),l=u(r(234));function u(e){return e&&e.__esModule?e:{default:e}}var d={};d.module=angular.module("gmfapp",["gettext",a.default.module.name,n.default.module.name,i.default.module.name]),d.module.value("gmfTreeUrl","https://geomapfish-demo.camptocamp.net/2.2/wsgi/themes?version=2&background=background"),d.module.value("gmfLayersUrl","https://geomapfish-demo.camptocamp.net/2.2/wsgi/layers/"),d.module.constant("defaultTheme","Demo"),d.module.constant("angularLocaleScript","../build/angular-locale_{{locale}}.js"),d.MainController=function(e,t,r,a,n){var i=this;this.http_=e,this.q_=t,this.gmfThemes_=a,this.gmfXSDAttributes_=n,this.urls=[{name:"oeedit app. (hosted)",url:"apps/oeedit/"},{name:"oeedit app. (dev)",url:"../apps/oeedit/"},{name:"example",url:"objectediting.html"}],this.viewerUrlDev_="../apps/oeview/",this.viewerUrlHosted_="apps/oeview/",this.selectedUrl=this.urls[0],this.gmfServers_,this.gmfServer_,this.gmfLayerNodes=[],this.selectedGmfLayerNode=null,this.featuresCache_={},this.features=null,this.selectedFeature=null,this.geomTypeCache_={},this.selectedGeomType=void 0,r.$watch(function(){return i.selectedGmfLayerNode},function(e,t){i.selectedFeature=null,e&&(i.getFeatures_(e).then(i.handleGetFeatures_.bind(i,e)),i.getGeometryType_(e).then(i.handleGetGeometryType_.bind(i,e)))}),this.themeName="ObjectEditing",this.gmfThemes_.loadThemes(),this.gmfThemes_.getOgcServersObject().then(function(e){i.gmfServers_=e,i.gmfThemes_.getThemesObject().then(function(e){if(e){var t=void 0,r=void 0,a=void 0;for(t=0,r=e.length;t<r;t++)if(e[t].name===i.themeName){a=e[t];break}if(a){var n=a.children[0];o.default.assert(n.ogcServer);var s=i.gmfServers_[n.ogcServer];if(s&&!0===s.wfsSupport&&s.urlWfs){i.gmfServer_=s;var l=[];for(t=0,r=n.children.length;t<r;t++)n.children[t].metadata.identifierAttributeField&&l.push(n.children[t]);i.gmfLayerNodes=l,i.selectedGmfLayerNode=i.gmfLayerNodes[1]}}}})})},d.MainController.$inject=["$http","$q","$scope","gmfThemes","gmfXSDAttributes"],d.MainController.prototype.runEditor=function(){var e=this.selectedGeomType,t=this.selectedFeature,r=this.selectedGmfLayerNode.id,a=this.selectedGmfLayerNode.metadata.identifierAttributeField;o.default.assert(void 0!==a);var i=t.get(a),s={};s[n.default.Param.GEOM_TYPE]=e,s[n.default.Param.ID]=i,s[n.default.Param.LAYER]=r,s[n.default.Param.THEME]=this.themeName,s[n.default.Param.PROPERTY]=a;var l=d.MainController.appendParams(this.selectedUrl.url,s);window.open(l)},d.MainController.prototype.runViewerDev=function(){this.runViewer_(this.viewerUrlDev_)},d.MainController.prototype.runViewerHosted=function(){this.runViewer_(this.viewerUrlHosted_)},d.MainController.prototype.runViewer_=function(e){var t=this.selectedGmfLayerNode,r=t.id,a=t.name,n=t.metadata.identifierAttributeField;o.default.assert(void 0!==n);for(var i=[],s=this.featuresCache_[r],l=0,u=s.length;l<u;l++)i.push(s[l].get(n));var h={};h.wfs_layer=a,h["wfs_"+n]=i.join(",");var f=d.MainController.appendParams(e,h);window.open(f)},d.MainController.prototype.getFeatures_=function(e){return this.getFeaturesDeferred_=this.q_.defer(),this.getFeaturesFromCache_(e)?this.getFeaturesDeferred_.resolve():this.issueGetFeatures_(e),this.getFeaturesDeferred_.promise},d.MainController.prototype.issueGetFeatures_=function(e){var t=this,r=e.id,o=d.MainController.appendParams(this.gmfServer_.urlWfs,{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:"1.1.0",TYPENAME:e.layers});this.http_.get(o).then(function(e){var o=(new s.default).readFeatures(e.data);t.featuresCache_[r]=o,t.getFeaturesDeferred_.resolve()})},d.MainController.prototype.handleGetFeatures_=function(e){var t=this.getFeaturesFromCache_(e);this.features=t,this.selectedFeature=this.features[0]},d.MainController.prototype.getFeaturesFromCache_=function(e){var t=e.id;return this.featuresCache_[t]||null},d.MainController.prototype.getGeometryType_=function(e){return this.getGeometryTypeDeferred_=this.q_.defer(),this.getGeometryTypeFromCache_(e)?this.getGeometryTypeDeferred_.resolve():this.issueGetAttributesRequest_(e),this.getGeometryTypeDeferred_.promise},d.MainController.prototype.issueGetAttributesRequest_=function(e){this.gmfXSDAttributes_.getAttributes(e.id).then(function(e,t){var r=l.default.getGeometryAttribute(t);r&&r.geomType&&(this.geomTypeCache_[e.id]=r.geomType,this.getGeometryTypeDeferred_.resolve())}.bind(this,e))},d.MainController.prototype.handleGetGeometryType_=function(e){var t=this.getGeometryTypeFromCache_(e);this.selectedGeomType=t},d.MainController.prototype.getGeometryTypeFromCache_=function(e){var t=e.id;return this.geomTypeCache_[t]},d.MainController.appendParams=function(e,t){var r=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&r.push(e+"="+encodeURIComponent(t[e]))});var o=r.join("&");return(e=-1===(e=e.replace(/[?&]$/,"")).indexOf("?")?e+"?":e+"&")+o},d.module.controller("MainController",d.MainController),t.default=d},390:function(e,t,r){r(54),r(53),e.exports=r(389)},594:function(e,t){}});
//# sourceMappingURL=objecteditinghub.5d335cfc887f9f8b4243.js.map